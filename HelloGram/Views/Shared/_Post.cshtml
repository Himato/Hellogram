@using HelloGram.Core.ViewModels
@model PostViewModel

<div class="card shadow mb-4 js-post-container" data-user-name="@(Model.AuthorUsername)" data-post-id="@(Model.Id)">
    <div class="card-body@(!Model.IsTrash ? " pb-0" : "")">
        <div class="row">
            <a href="@Url.Action("UsersProfile", "Users", new { username =  Model.AuthorUsername })" target="_blank">
                <img src="/Content/Images/Users/@Model.AuthorImage" class="rounded-circle post-user-image" alt="User Image">
            </a>
            <div class="col">
                <div class="row ml-0">
                    <a href="@Url.Action("UsersProfile", "Users", new { username =  Model.AuthorUsername })" target="_blank">
                        <span class="h2 font-weight-bold mb-0">@Model.AuthorName</span>
                    </a>
                    @if (!Model.IsCategory)
                    {
                        <a href="@Url.Action("Category", "Categories", new { id = Model.CategoryId })">
                            <span class="h5 text-uppercase text-primary ml-1"> - @Model.CategoryName</span>
                        </a>
                    }
                </div>
                <a href="@Url.Action("UserPost", "Users", new { username =  Model.AuthorUsername, postId = Model.Id })" class="card-title text-sm text-muted text-nowrap mb-0" data-toggle="tooltip" data-placement="top" title="@Model.Date">@Model.GetFormattedDate()</a>
            </div>
            <div class="col-auto">
                <a class="ni ni-bold-down mt-2" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></a>
                <div class="dropdown-menu dropdown-menu-arrow dropdown-menu-right">
                    @if (!Model.IsTrash)
                    {
                        if (!Model.IsLogged)
                        {
                            <a href="javascript:void(0);" class="dropdown-item js-post-save">
                                <i class="fas fa-bookmark w-10"></i>
                                <span class="js-post-save-text">@(Model.IsSaved ? "Unsave" : "Save") Post</span>
                            </a>
                            <a href="javascript:void(0);" class="dropdown-item js-post-follow" data-user-id="@Model.AuthorId">
                                <i class="fas fa-rss w-10"></i>
                                <span class="js-post-follow-text">@(!Model.IsFollowing ? "Follow" : "Unfollow")</span>
                                <span class="d-inline"> @Model.AuthorName</span>
                            </a>
                            <a href="javascript:void(0);" class="dropdown-item js-post-copy-url">
                                <i class="fas fa-code w-10"></i>
                                <span>Copy URL</span>
                            </a>
                            <a href="javascript:void(0);" class="dropdown-item">
                                <i class="fas fa-bell w-10"></i>
                                <span class="js-turn-on-notifications" data-state="@Model.IsSubscribed">Turn @(Model.IsSubscribed ? "off" : "on") notifications</span>
                            </a>
                            <div class="dropdown-divider"></div>
                            <a href="javascript:void(0);" class="dropdown-item text-danger js-report">
                                <i class="fas fa-flag w-10"></i>
                                <span>Report</span>
                            </a>
                        }
                        else
                        {
                            <a href="javascript:void(0);" class="dropdown-item js-post-edit" data-toggle="modal" data-target="#edit-post-modal">
                                <i class="fas fa-pen-square w-10"></i>
                                <span>Edit Post</span>
                            </a>
                            <a href="javascript:void(0);" class="dropdown-item js-post-copy-url">
                                <i class="fas fa-code w-10"></i>
                                <span>Copy URL</span>
                            </a>
                            <div class="dropdown-divider"></div>
                            <a href="javascript:void(0);" class="dropdown-item text-danger js-post-delete">
                                <i class="fas fa-trash w-10"></i>
                                <span>Delete</span>
                            </a>
                        }
                    }
                    else
                    {
                        <a href="javascript:void(0);" class="dropdown-item js-post-re-post">
                            <i class="fas fa-retweet text-green w-10"></i>
                            <span>Re-post</span>
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="javascript:void(0);" class="dropdown-item text-danger js-post-delete-permanently" data-toggle="modal" data-target="#modal-delete-confirmation">
                            <i class="fas fa-trash w-10"></i>
                            <span>Delete permanently</span>
                        </a>
                    }
                </div>
            </div>
        </div>
        <pre class="post-text @(Model.Text.Length < 100 && Model.Text.Count(x => x == 10) < 3 ? Model.Image == null ? "post-text-lg" : "" :
                                                                                                Model.Image == null ? Model.Text.Length >= 300 || Model.Text.Count(x => x == 10) >= 3 ? "buffer" : "" :
                                                                                                                      Model.Text.Length >= 150 || Model.Text.Count(x => x == 10) >= 3 ? "buffer" : "")">@Model.Text</pre>
        @if (Model.Image != null)
        {
            <div class="text-center">
                <img class="post-image" src="/Content/Images/Posts/@Model.Image" alt="Post Image" data-action="zoom" />
            </div>
        }
        @if (!Model.IsTrash)
        {
            <p class="mt-3 mb-0 text-muted text-sm">
                <span class="text-success mr-2"><i class="fas fa-thumbs-up"></i> <span class="js-post-like-number">@Model.NumberOfLikes</span></span>
                <span class="text-danger mr-2"><i class="fas fa-thumbs-down"></i> <span class="js-post-dislike-number">@Model.NumberOfDisLikes</span></span>
                <span class="text-nowrap"> - <span class="d-inline js-post-comment-number">@Model.NumberOfComments</span> Comments</span>
            </p>
            <div class="dropdown-divider mb-2"></div>
            <div class="row mb-2 js-react">
                <div class="col py-2">
                    <a href="javascript:void(0);" class="@(Model.IsReact && Model.IsLike ? "text-green " : "")post-btn js-post-like">
                        <i class="fas fa-thumbs-up"></i> Like
                    </a>
                </div>
                <div class="col py-2">
                    <a href="javascript:void(0);" class="text-primary post-btn js-post-comment-btn">
                        <i class="fas fa-comments"></i> Comment
                    </a>
                </div>
                <div class="col py-2">
                    <a href="javascript:void(0);" class="@(Model.IsReact && !Model.IsLike ? "text-red " : "")post-btn js-post-dislike">
                        <i class="fas fa-thumbs-down"></i> Dislike
                    </a>
                </div>
            </div>
            <div class="dropdown-divider hide mb-3 js-post-divider"></div>
            <div class="row hide mb-3 js-post-comment-container">
                <a href="@Url.Action("UserProfile", "Users")">
                    <img src="/Content/Images/Users/@Model.UserImage" class="rounded-circle post-new-comment-user-image mt-2" alt="User Image">
                </a>
                <div class="col d-inline-block js-post-textarea">
                    <textarea class="form-control form-control-alternative post-comment js-post-comment" placeholder="Type your comment here" maxlength="500"></textarea>
                </div>
            </div>
            <div class="js-post-comments-container">
                @if (Model.CommentViewModel != null)
                {
                    @Html.Partial("_Comment", Model.CommentViewModel)
                }
                <div class="row hide mb-3 js-post-comment-container">
                    <a class="card-link text-sm spinner-black ml-3 js-post-view-more" href="javascript:void(0);">
                        <span class="js-post-view-more-content">View more comments ...</span>
                        <div class="bounce1"></div>
                        <div class="bounce2"></div>
                        <div class="bounce3"></div>
                    </a>
                </div>
            </div>
        }
    </div>
</div>